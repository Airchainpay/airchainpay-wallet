#!/usr/bin/env node

/**
 * Android Emulator Hostname Fix Script
 * 
 * This script helps fix the "Unable to resolve host" error in Android emulators
 * by setting up the correct environment variables for development.
 */

const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

console.log('üîß Setting up Android emulator hostname fix...');

// Check if running on macOS
const isMac = process.platform === 'darwin';
if (isMac) {
  console.log('‚úÖ Detected macOS environment');
} else {
  console.log('‚ö†Ô∏è This script is optimized for macOS. Some steps may not work on your platform.');
}

// Get the script directory
const scriptDir = path.dirname(process.argv[1]);
const projectRoot = path.join(scriptDir, '..');

// Create a .env.local file with the correct configuration
const envPath = path.join(projectRoot, '.env.local');
const envContent = `
# Android Emulator Connection Fix
# This file was generated by fix-android-hostname.js
EXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0
REACT_NATIVE_PACKAGER_HOSTNAME=10.0.2.2
`;

try {
  fs.writeFileSync(envPath, envContent, 'utf8');
  console.log(`‚úÖ Created .env.local with proper configuration`);
} catch (error) {
  console.error(`‚ùå Error creating .env.local: ${error.message}`);
}

console.log('\nüì± Android Emulator Connection Instructions:');
console.log('1. Make sure your Android emulator is running');
console.log('2. Start your Expo app with: npx expo start --clear');
console.log('3. Press "a" to open in Android emulator');
console.log('\nIf you still have issues:');
console.log('- Try using the tunnel option: npx expo start --tunnel --clear');
console.log('- Make sure your firewall is not blocking connections');
console.log('- Try restarting your Android emulator');

// Try to kill any existing Metro processes
try {
  console.log('\nüîÑ Attempting to kill any existing Metro processes...');
  if (isMac) {
    execSync('pkill -f "metro" || true');
    console.log('‚úÖ Killed Metro processes');
  }
} catch (error) {
  // Ignore errors from pkill
}

console.log('\n‚ú® Setup complete! Run your app with: npx expo start --clear'); 